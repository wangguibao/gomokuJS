<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
<head>
    <title>Gomoku (since 2017)</title>
    <link rel="stylesheet" type="text/css" href="gomokuJS.css"/>
    <script type="text/javascript" src="gomokuJS.js"></script>
</head>
<body>
    <div>
        <div id="main">
            <img id='board' src='images/board.png'></img>
            <img id='pointer' src='images/pointer.png'></img>
            <span id='win'></span>
        </div>
    </div>
<script>
var man = new Player('black');
var machine = new Player('white');
var board = new Board();
var DIR = 0;

function win(dir, reason)
{
    // window.alert(dir == 0 ? 'Black wins' : 'White wins');
    var span = document.querySelector('#win');
    var winner = dir == 0 ? 'Black' : 'White';
    span.textContent = winner + ' wins';
    span.style.display = 'inline';
    span.style.position = 'absolute';
    span.style.left = span.parentElement.offsetWidth / 3 + 'px';
    span.style.bottom = span.parentElement.offsetHeight * 2 / 3 + 'px';
}

function lose(dir, error)
{
    var reason = "";
    switch (error) {
    case GLOBAL.boardStatus.PARAM_ERROR:
        reason = "Parameter error";
        break;
    case GLOBAL.boardStatus.FORBIDDEN_LONG_CHAIN:
        reason = "Long chain";
        break;
    case GLOBAL.boardStatus.FORBIDDEN_3_3:
        reason = "3-3 forbidden";
        break;
    case GLOBAL.boardStatus.FORBIDDEN_4_4:
        reason = "4-4 forbidden";
        break;
    default:
        break;
    }
    window.alert((dir == 0 ? 'Black lose: ' : 'White lose: ') + reason);
}

function handleKeyPress(key)
{
    var pointer = document.getElementById('pointer');
    var background = document.getElementById('board');
    var backgroundHeight = background.offsetHeight;
    var backgroundWidth = background.offsetWidth;
    
    var left = parseInt(pointer.style.left);
    var bottom = parseInt(pointer.style.bottom);
    if (key.code == 'ArrowUp') {
        if (bottom + 32 < backgroundHeight) {
            bottom += 32;
        }
        pointer.style.bottom = bottom + 'px';
    }
    else if (key.code == 'ArrowDown') {
        if (bottom - 32 >= 5) {
            bottom -= 32;
        }
        pointer.style.bottom = bottom + 'px';
    }
    else if (key.code == 'ArrowLeft') {
        if (left - 32 >= 3) {
            left -= 32;
        }
        pointer.style.left = left + 'px';
    }
    else if (key.code == 'ArrowRight') {
        if (left + 32 < backgroundWidth) {
            left += 32;
        }
        pointer.style.left = left + 'px';
    }
    else if (key.code == 'Space') {
        var x = (left - 3) / 32;
        var y = (bottom - 5) / 32;
        if (board.occupied(x, y)) {
            return false;
        }
        if (DIR == 0) {
            man.go(x, y);
        }
        else if (DIR == 1) {
            machine.go(x, y);
        }
        var ret = board.judge(DIR, x, y);
        if (ret == GLOBAL.boardStatus.WIN) {
            win(DIR);
        }
        else if (ret == GLOBAL.boardStatus.FORBIDDEN_LONG_CHAIN) {
            lose(DIR, ret);
        }
        DIR = !DIR;
    }
    
    return false;
}

function main()
{
    var pointer = document.getElementById('pointer');
    pointer.style.left = '3px';
    pointer.style.bottom = '5px';

    document.body.addEventListener('keydown', handleKeyPress);
}
main();
</script>
</body>
</html>
